# Alembic Database Migrations (`backend/alembic/`)

This directory contains the configuration and scripts for Alembic, a database migration tool for SQLAlchemy. Alembic allows for the management of relational database schemas in a version-controlled and incremental way.

## Purpose of Alembic

When your SQLAlchemy models (defined in `backend/models.py`) change, Alembic can compare the models against the current state of your database schema and automatically generate migration scripts. These scripts contain Python code to apply the necessary changes (e.g., create tables, add columns, modify types) to bring the database schema in line with the models.

This is crucial for:
-   **Schema Versioning**: Keeping track of database changes alongside your application code.
-   **Reproducibility**: Ensuring that database schemas can be consistently created and upgraded across different environments (development, testing, production).
-   **Collaboration**: Allowing multiple developers to make and track schema changes without conflicts.

## Key Files and Directories

-   **`env.py`**:
    -   This is the main configuration script that Alembic runs when a migration command is executed.
    -   It sets up the database connection for migrations (by reading `sqlalchemy.url` from `alembic.ini`).
    -   Crucially, it imports your SQLAlchemy models (`Base` from `backend.models.py` and specific models like `Project`, `Agent`, `Task`) and sets `target_metadata = Base.metadata`. This allows Alembic's "autogenerate" feature to detect changes between your models and the database schema.
    -   It includes logic to run migrations in "offline" mode (generating SQL scripts) or "online" mode (connecting to the database and applying changes directly).

-   **`versions/`**:
    -   This directory stores the individual migration script files generated by Alembic (e.g., when you run `alembic revision -m "create_my_table"`).
    -   Each file in this directory represents a specific version or change to the database schema.
    -   These scripts contain `upgrade()` and `downgrade()` functions, defining how to apply and revert the schema changes, respectively.

-   **`script.py.mako`**:
    -   A Mako template file used by Alembic to generate the structure of new migration scripts created in the `versions/` directory.

-   **`README`**:
    -   A minimal, default README provided by Alembic.

-   **`alembic.ini`** (located in the parent `backend/` directory):
    -   The main configuration file for Alembic. It specifies settings like the database URL (`sqlalchemy.url`), the location of the migration script directory (`script_location`), and other options.

## Common Alembic Commands

(Run these from the `backend/` directory, where `alembic.ini` is located)

-   **`alembic revision -m "create_some_table"`**: Creates a new blank migration script.
-   **`alembic revision --autogenerate -m "Add new_column to my_table"`**: Attempts to automatically generate a migration script by comparing `target_metadata` (from your models) with the current database schema.
-   **`alembic upgrade head`**: Applies all pending migrations up to the latest version (the "head").
-   **`alembic upgrade +1`**: Applies the next migration.
-   **`alembic downgrade -1`**: Reverts the last applied migration.
-   **`alembic history`**: Shows the migration history.
-   **`alembic current`**: Shows the current database revision.

Properly configured and used, Alembic provides robust control over your database schema evolution alongside your application code. 